<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¹ã‚¿ãƒƒãƒ•æ³¨æ–‡ç®¡ç†</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: 'Segoe UI', Arial, sans-serif; background:#f5f5f5; }

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
header { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color:white; 
    padding:15px 30px; 
    display:flex; 
    justify-content:space-between; 
    align-items:center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
header h1 { font-size:24px; }
.header-actions { display:flex; gap:15px; align-items:center; }
.notification-icon { 
    position:relative; 
    background:rgba(255,255,255,0.2); 
    padding:8px 15px; 
    border-radius:8px; 
    cursor:pointer;
    font-size:18px;
}
.notification-badge { 
    position:absolute; 
    top:-5px; 
    right:-5px; 
    background:#ff4757; 
    color:white; 
    border-radius:50%; 
    padding:2px 8px; 
    font-size:12px;
    display:none;
}
.notification-badge.active { display:block; }
.logout-btn { 
    background:rgba(255,255,255,0.2); 
    color:white; 
    border:none; 
    padding:8px 15px; 
    border-radius:8px; 
    cursor:pointer; 
    text-decoration:none;
}
.logout-btn:hover { background:rgba(255,255,255,0.3); }

/* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
.main { display:flex; padding:20px; gap:20px; max-width:1400px; margin:0 auto; }

/* å·¦å´ï¼šãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ */
.table-list { 
    width:220px; 
    display:grid; 
    grid-template-columns:1fr 1fr;
    gap:12px; 
    height:fit-content;
}
.table-item { 
    padding:20px 10px; 
    border-radius:10px; 
    color:white; 
    text-align:center; 
    cursor:pointer; 
    position:relative;
    font-weight:bold;
    font-size:16px;
    transition: all 0.3s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.table-item:hover { transform:translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

/* ãƒ†ãƒ¼ãƒ–ãƒ«çŠ¶æ…‹åˆ¥ã®è‰² */
.table-item.empty { background:#95a5a6; } /* ç©ºå¸­ */
.table-item.occupied { background:#3498db; } /* ä½¿ç”¨ä¸­ */
.table-item.pending-payment { background:#f39c12; } /* ä¼šè¨ˆå¾…ã¡ */
.table-item.active { 
    outline: 3px solid #2ecc71; 
    outline-offset: 2px;
}

/* é€šçŸ¥ãƒãƒ¼ã‚¯ï¼ˆæ–°è¦æ³¨æ–‡ã‚ã‚Šï¼‰ */
.table-item.notification::after {
    content: attr(data-badge); 
    position:absolute; 
    right:8px; 
    top:8px; 
    background:#e74c3c; 
    width:24px; 
    height:24px;
    border-radius:50%; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    font-size:14px;
    font-weight:bold;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% { transform:scale(1); opacity:1; }
    50% { transform:scale(1.1); opacity:0.8; }
}

/* å³å´ï¼šæ³¨æ–‡è©³ç´°ãƒ‘ãƒãƒ« */
.side-panel {
    flex-grow:1; 
    background:#fff; 
    border-radius:12px;
    padding:25px; 
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.side-panel h3 { 
    color:#333; 
    margin-bottom:20px; 
    padding-bottom:10px; 
    border-bottom:2px solid #667eea;
    font-size:22px;
}

.empty-state {
    text-align:center;
    color:#999;
    padding:60px 20px;
    font-size:16px;
}

/* æ³¨æ–‡ã‚¢ã‚¤ãƒ†ãƒ  */
.order-section { margin-bottom:25px; }
.order-section h4 { 
    color:#667eea; 
    margin-bottom:12px; 
    font-size:16px;
    display:flex;
    align-items:center;
    gap:8px;
}
.order-time {
    color:#999;
    font-size:13px;
    font-weight:normal;
}

.order-item { 
    display:flex; 
    justify-content:space-between; 
    align-items:center;
    margin:10px 0; 
    padding:12px;
    background:#f8f9fa;
    border-radius:8px;
    border-left:4px solid #667eea;
    transition: all 0.3s;
}
.order-item:hover { background:#e9ecef; }

.order-item-info {
    flex-grow:1;
}
.order-item-name { 
    font-weight:600; 
    color:#333;
    font-size:15px;
}
.order-item-options {
    font-size:13px;
    color:#666;
    margin-top:3px;
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ãƒ™ãƒ« */
.status-label {
    padding:4px 12px;
    border-radius:12px;
    font-size:12px;
    font-weight:bold;
    margin-right:10px;
}
.status-pending { background:#ffebee; color:#c62828; }
.status-delivered { background:#e8f5e9; color:#2e7d32; }

/* æä¾›æ¸ˆã¿ */
.order-item.delivered { 
    opacity:0.6;
    border-left-color:#ccc;
}
.order-item.delivered .order-item-name { 
    text-decoration:line-through; 
    color:#999; 
}

/* ãƒœã‚¿ãƒ³ */
.btn { 
    padding:6px 14px; 
    cursor:pointer; 
    border:none; 
    border-radius:6px; 
    font-size:13px;
    font-weight:600;
    transition: all 0.3s;
}
.btn:hover { opacity:0.85; transform:translateY(-1px); }
.btn:disabled { 
    opacity:0.5; 
    cursor:not-allowed; 
    transform:none;
}

.btn-primary { background:#667eea; color:white; }
.btn-success { background:#2ecc71; color:white; }
.btn-warning { background:#f39c12; color:white; }
.btn-danger { background:#e74c3c; color:white; }

/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ */
.action-area {
    margin-top:25px;
    padding-top:20px;
    border-top:2px solid #eee;
    display:flex;
    gap:10px;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal {
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    z-index:1000;
    align-items:center;
    justify-content:center;
    overflow-y:auto;
}
.modal.active { display:flex; }
.modal-content {
    background:white;
    border-radius:12px;
    width:90%;
    max-width:600px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}
.modal-header {
    padding:20px;
    border-bottom:1px solid #eee;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.modal-header h3 { color:#333; font-size:20px; }
.close-btn {
    background:none;
    border:none;
    font-size:24px;
    cursor:pointer;
    color:#999;
}
.close-btn:hover { color:#333; }
.modal-body { padding:20px; }
.modal-footer {
    padding:20px;
    border-top:1px solid #eee;
    display:flex;
    justify-content:flex-end;
    gap:10px;
}

/* ä¼šè¨ˆè©³ç´° */
.checkout-item {
    display:flex;
    justify-content:space-between;
    padding:10px 0;
    border-bottom:1px solid #f0f0f0;
}
.checkout-total {
    margin-top:15px;
    padding-top:15px;
    border-top:2px solid #333;
    font-size:18px;
    font-weight:bold;
    text-align:right;
}
.payment-method {
    margin-top:20px;
}
.payment-method label {
    display:block;
    margin-bottom:8px;
    font-weight:600;
}
.payment-method select {
    width:100%;
    padding:10px;
    border:1px solid #ddd;
    border-radius:6px;
    font-size:14px;
}
</style>
</head>
<body>

<header>
    <h1>ğŸ“‹ ã‚¹ã‚¿ãƒƒãƒ•æ³¨æ–‡ç®¡ç†</h1>
    <div class="header-actions">
        <div class="notification-icon" onclick="showAllOrdersHistory()">
            ğŸ”” <span id="notificationBadge" class="notification-badge">0</span>
        </div>
        <a href="#" class="logout-btn" onclick="alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ï¼ˆæœªå®Ÿè£…ï¼‰')">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>
</header>

<div class="main">
    <div class="table-list" id="tableList"></div>
    <div class="side-panel" id="sidePanel">
        <h3>ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°</h3>
        <div class="empty-state">
            <p>ğŸ‘ˆ å·¦å´ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
        </div>
    </div>
</div>

<div id="checkoutModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ’° ä¼šè¨ˆå‡¦ç†</h3>
            <button class="close-btn" onclick="closeCheckoutModal()">&times;</button>
        </div>
        <div class="modal-body" id="checkoutDetails"></div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="closeCheckoutModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button class="btn btn-success" id="confirmCheckoutBtn" onclick="confirmCheckout()">ä¼šè¨ˆå®Œäº†</button>
        </div>
    </div>
</div>

<div id="historyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ“œ æ³¨æ–‡å±¥æ­´</h3>
            <button class="close-btn" onclick="closeHistoryModal()">&times;</button>
        </div>
        <div class="modal-body" id="historyBody">
            <p>èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
    </div>
</div>

<script>
// ========================
// ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
// ========================
let tablesData = [
    { id:1, number:1, is_occupied:true, has_pending_payment:false },
    { id:2, number:2, is_occupied:true, has_pending_payment:false },
    { id:3, number:3, is_occupied:false, has_pending_payment:false },
    { id:4, number:4, is_occupied:true, has_pending_payment:false },
    { id:5, number:5, is_occupied:false, has_pending_payment:false },
    { id:6, number:6, is_occupied:true, has_pending_payment:true },
    { id:7, number:7, is_occupied:false, has_pending_payment:false },
    { id:8, number:8, is_occupied:true, has_pending_payment:false },
    { id:9, number:9, is_occupied:false, has_pending_payment:false },
    { id:10, number:10, is_occupied:false, has_pending_payment:false }
];

let ordersData = {
    1: [
        { id:101, table_id:1, name:'ãƒã‚­ãƒ³ã‚«ãƒ¬ãƒ¼ã‚»ãƒƒãƒˆ', options:'è¾›ã•: ä¸­è¾›, ãƒŠãƒ³: ã‚¬ãƒ¼ãƒªãƒƒã‚¯', status:'pending', price:1200 },
        { id:102, table_id:1, name:'ãƒãƒ³ã‚´ãƒ¼ãƒ©ãƒƒã‚·ãƒ¼', options:null, status:'pending', price:500 }
    ],
    2: [
        { id:201, table_id:2, name:'ãƒã‚¿ãƒ¼ãƒã‚­ãƒ³ã‚«ãƒ¬ãƒ¼', options:'è¾›ã•: ç”˜å£', status:'delivered', price:1300 }
    ],
    6: [
        { id:601, table_id:6, name:'ãƒãƒˆãƒ³ã‚«ãƒ¬ãƒ¼ã‚»ãƒƒãƒˆ', options:'è¾›ã•: ä¸­è¾›', status:'delivered', price:1400 }
    ]
};

// ========================
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
// ========================
let currentTableId = null;

// ========================
// åˆæœŸè¡¨ç¤º
// ========================
document.addEventListener('DOMContentLoaded', () => {
    renderTables();
    updateNotificationBadge();
});

// ========================
// ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§æç”»
// ========================
function renderTables() {
    const container = document.getElementById('tableList');
    container.innerHTML = tablesData.map(table => {
        let statusClass = 'empty';
        if(table.has_pending_payment){ statusClass='pending-payment'; }
        else if(table.is_occupied){ statusClass='occupied'; }

        const pendingCount = ordersData[table.id]?.filter(o=>o.status==='pending').length || 0;
        const notificationClass = pendingCount>0 ? 'notification' : '';
        const badgeAttr = pendingCount>0 ? `data-badge="${pendingCount}"` : '';

        const activeClass = currentTableId===table.id ? 'active':'';
        return `<div class="table-item ${statusClass} ${notificationClass} ${activeClass}" ${badgeAttr} data-id="${table.id}" onclick="selectTable(${table.id})">
            #${table.number}
        </div>`;
    }).join('');
}

// ========================
// ãƒ†ãƒ¼ãƒ–ãƒ«é¸æŠ
// ========================
function selectTable(tableId){
    currentTableId = tableId;
    const table = tablesData.find(t=>t.id===tableId);
    const orders = ordersData[tableId] || [];

    renderTables();

    const panel = document.getElementById('sidePanel');
    if(orders.length===0){
        panel.innerHTML = `<h3>ãƒ†ãƒ¼ãƒ–ãƒ« #${table.number}</h3><div class="empty-state"><p>ğŸ“ æ³¨æ–‡ã¯ã‚ã‚Šã¾ã›ã‚“</p></div>`;
        return;
    }

    const groupedOrders = {
        pending: orders.filter(o=>o.status==='pending'),
        delivered: orders.filter(o=>o.status==='delivered')
    };

    let html = `<h3>ãƒ†ãƒ¼ãƒ–ãƒ« #${table.number}</h3>`;

    const statusConfig = {
        pending:{label:'ğŸ“¥ æ³¨æ–‡å—ä»˜', color:'pending'},
        delivered:{label:'âœ”ï¸ æä¾›æ¸ˆã¿', color:'delivered'}
    };

    Object.entries(statusConfig).forEach(([status, config])=>{
        if(groupedOrders[status].length>0){
            html+=`<div class="order-section">`;
            html+=`<h4>${config.label} <span class="order-time">(${groupedOrders[status].length}ä»¶)</span></h4>`;

            groupedOrders[status].forEach(order=>{
                const deliveredClass = status==='delivered'?'delivered':'';
                html+=`
                <div class="order-item ${deliveredClass}" data-order-id="${order.id}">
                    <div class="order-item-info">
                        <div class="order-item-name">${order.name}</div>
                        ${order.options?`<div class="order-item-options">${order.options}</div>`:''}
                    </div>
                    <span class="status-label status-${config.color}">${config.label.split(' ')[1]}</span>
                    ${status==='pending'?getOrderActionButton(order):''}
                </div>
                `;
            });
            html+=`</div>`;
        }
    });

    const hasDeliveredOrders = groupedOrders.delivered.length>0 || groupedOrders.pending.length>0;
    if(hasDeliveredOrders && !table.has_pending_payment){
        html+=`<div class="action-area">
            <button class="btn btn-warning" onclick="requestCheckout(${tableId})">ğŸ’° ä¼šè¨ˆã‚’å‘¼ã¶</button>
        </div>`;
    }

    if(table.has_pending_payment){
        html+=`<div class="action-area">
            <button class="btn btn-danger" onclick="openCheckoutModal(${tableId})">ğŸ’³ ä¼šè¨ˆã‚’å®Œäº†ã™ã‚‹</button>
        </div>`;
    }

    panel.innerHTML = html;
}

// ========================
// ãƒœã‚¿ãƒ³ç”Ÿæˆ
// ========================
function getOrderActionButton(order){
    return `<button class="btn btn-primary" onclick="updateOrderStatus(${order.id}, 'delivered')">æä¾›æ¸ˆã¿ã«ã™ã‚‹</button>`;
}

// ========================
// æ³¨æ–‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
// ========================
function updateOrderStatus(orderId, newStatus){
    for(let tableId in ordersData){
        const order = ordersData[tableId].find(o=>o.id===orderId);
        if(order){ order.status=newStatus; break; }
    }
    selectTable(currentTableId);
    renderTables();
    updateNotificationBadge();
}

// ========================
// ä¼šè¨ˆæ©Ÿèƒ½
// ========================
function requestCheckout(tableId){
    const table = tablesData.find(t=>t.id===tableId);
    table.has_pending_payment=true;
    alert(`ãƒ†ãƒ¼ãƒ–ãƒ« #${table.number} ãŒä¼šè¨ˆã‚’è¦æ±‚ã—ã¾ã—ãŸ`);
    renderTables();
    selectTable(tableId);
}

function openCheckoutModal(tableId){
    const table = tablesData.find(t=>t.id===tableId);
    const orders = ordersData[tableId] || [];
    const totalAmount = orders.reduce((sum,o)=>sum+(o.price||0),0);

    let detailsHtml=`<h4>ãƒ†ãƒ¼ãƒ–ãƒ« #${table.number}</h4>
    <div style="max-height:300px
        ; overflow-y:auto;">`;
    orders.forEach(o=>{
        detailsHtml+=`<div class="checkout-item">
            <span>${o.name}${o.options?` (${o.options})`:''}</span>
            <span>Â¥${o.price}</span>
        </div>`;
    });
    detailsHtml+=`<div class="checkout-total">åˆè¨ˆ: Â¥${totalAmount}</div>`;
    document.getElementById('checkoutDetails').innerHTML = detailsHtml;

    document.getElementById('confirmCheckoutBtn').dataset.tableId = tableId;
    document.getElementById('checkoutModal').classList.add('active');
}

function closeCheckoutModal(){
    document.getElementById('checkoutModal').classList.remove('active');
}

function confirmCheckout(){
    const tableId = parseInt(document.getElementById('confirmCheckoutBtn').dataset.tableId);
    // æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ç©ºå¸­åŒ–
    delete ordersData[tableId];
    const table = tablesData.find(t=>t.id===tableId);
    table.is_occupied = false;
    table.has_pending_payment = false;

    renderTables();
    selectTable(tableId);
    closeCheckoutModal();
    alert(`ãƒ†ãƒ¼ãƒ–ãƒ« #${table.number} ã®ä¼šè¨ˆãŒå®Œäº†ã—ã¾ã—ãŸ`);
}

// ========================
// é€šçŸ¥ãƒãƒƒã‚¸æ›´æ–°
// ========================
function updateNotificationBadge(){
    let pendingCount = 0;
    for(let tableId in ordersData){
        pendingCount += ordersData[tableId].filter(o=>o.status==='pending').length;
    }
    const badge = document.getElementById('notificationBadge');
    badge.textContent = pendingCount;
    if(pendingCount>0) badge.classList.add('active');
    else badge.classList.remove('active');
}

// ========================
// æ³¨æ–‡å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ«
// ========================
function showAllOrdersHistory(){
    const historyBody = document.getElementById('historyBody');
    let html = '';

    const allOrders = [];
    for(let tableId in ordersData){
        ordersData[tableId].forEach(o=>{
            allOrders.push({...o, tableNumber: tablesData.find(t=>t.id==tableId).number});
        });
    }

    if(allOrders.length===0){
        html = '<p>ğŸ“ å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
    } else {
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é †ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
        const grouped = { pending:[], delivered:[] };
        allOrders.forEach(o=> grouped[o.status].push(o));

        const statusConfig = {
            pending:{label:'ğŸ“¥ æ³¨æ–‡å—ä»˜', color:'pending'},
            delivered:{label:'âœ”ï¸ æä¾›æ¸ˆã¿', color:'delivered'}
        };

        Object.entries(statusConfig).forEach(([status, config])=>{
            if(grouped[status].length>0){
                html+=`<div class="order-section"><h4>${config.label} (${grouped[status].length}ä»¶)</h4>`;
                grouped[status].forEach(o=>{
                    const deliveredClass = status==='delivered'?'delivered':'';
                    html+=`
                    <div class="order-item ${deliveredClass}">
                        <div class="order-item-info">
                            <div class="order-item-name">ãƒ†ãƒ¼ãƒ–ãƒ« #${o.tableNumber}: ${o.name}</div>
                            ${o.options?`<div class="order-item-options">${o.options}</div>`:''}
                        </div>
                        <span class="status-label status-${config.color}">${config.label.split(' ')[1]}</span>
                    </div>
                    `;
                });
                html+='</div>';
            }
        });
    }

    historyBody.innerHTML = html;
    document.getElementById('historyModal').classList.add('active');
}

function closeHistoryModal(){
    document.getElementById('historyModal').classList.remove('active');
}
</script>

</body>
</html>